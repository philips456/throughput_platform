{% extends "base.html" %}
{% load static %}

{% block title %}Load History - SynergyX{% endblock %}

{% block content %}


<!-- Loading Spinner -->
<div id="loading" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="flex items-center">
    <svg class="animate-spin h-10 w-10 text-cyan-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l5-5-5-5v4a12 12 0 00-12 12h4l5-5-5-5v4z"></path>
    </svg>
  </div>
</div>

<script>
  // JavaScript to hide loading spinner after 1 second
  setTimeout(function() {
    document.getElementById("loading").style.display = "none";
  }, 500);  // 500 milliseconds = 1 second
</script>
<div class="p-8 space-y-8">
  <h1 class="text-3xl font-bold text-yellow-400 mb-2">System Load History</h1>
  <p class="text-lg text-gray-300 mb-8">Track historical system load metrics to identify patterns, optimize resource allocation, and plan for capacity needs.</p>
  
  <!-- Time Range Selector -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl mb-8">
    <h2 class="text-xl font-semibold text-yellow-300 mb-4">Select Time Range</h2>
    <div class="grid grid-cols-1 md:grid-cols-6 gap-4">
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn active">24 Hours</button>
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn">7 Days</button>
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn">30 Days</button>
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn">3 Months</button>
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn">6 Months</button>
      <button class="bg-gray-700 text-white py-2 px-4 rounded-md hover:bg-gray-600 time-btn">1 Year</button>
    </div>
  </div>
  
  <!-- CPU Load Chart -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl">
    <h2 class="text-xl font-semibold text-yellow-300 mb-4">CPU Load History</h2>
    <div class="h-80">
      <canvas id="cpuChart"></canvas>
    </div>
  </div>
  
  <!-- Memory Usage Chart -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl">
    <h2 class="text-xl font-semibold text-yellow-300 mb-4">Memory Usage History</h2>
    <div class="h-80">
      <canvas id="memoryChart"></canvas>
    </div>
  </div>
  
  <!-- API Requests Chart -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl">
    <h2 class="text-xl font-semibold text-yellow-300 mb-4">API Requests History</h2>
    <div class="h-80">
      <canvas id="apiChart"></canvas>
    </div>
  </div>
  
  <!-- Load Anomalies -->
  <div class="bg-gray-800 p-6 rounded-2xl shadow-xl">
    <h2 class="text-xl font-semibold text-yellow-300 mb-4">Load Anomalies</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-700">
        <thead>
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Metric</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Value</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Threshold</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Duration</th>
          </tr>
        </thead>
        <tbody class="bg-gray-900 divide-y divide-gray-800">
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">2025-05-07 14:32</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">CPU</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-400">92%</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">80%</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">15 min</td>
          </tr>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">2025-05-07 08:15</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">Memory</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-400">87%</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">75%</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">25 min</td>
          </tr>
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">2025-05-07 22:45</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">API Requests</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-400">450/s</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">300/s</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">10 min</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Load Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Generate dates for the last 24 hours
    const dates = [];
    const now = new Date();
    for (let i = 23; i >= 0; i--) {
      const date = new Date(now);
      date.setHours(now.getHours() - i);
      dates.push(date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
    }
    
    // CPU Chart
    const cpuCtx = document.getElementById('cpuChart').getContext('2d');
    const cpuChart = new Chart(cpuCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [
          {
            label: 'CPU Load (%)',
            data: [45, 42, 47, 50, 55, 60, 65, 70, 75, 80, 85, 92, 88, 82, 78, 72, 68, 65, 60, 55, 50, 48, 45, 42],
            borderColor: 'rgba(245, 158, 11, 1)',
            backgroundColor: 'rgba(245, 158, 11, 0.1)',
            tension: 0.4,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            title: {
              display: true,
              text: 'CPU Load (%)',
              color: 'rgba(255, 255, 255, 0.7)'
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          },
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)',
              maxRotation: 45,
              minRotation: 45
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          }
        }
      }
    });
    
    // Memory Chart
    const memoryCtx = document.getElementById('memoryChart').getContext('2d');
    const memoryChart = new Chart(memoryCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [
          {
            label: 'Memory Usage (%)',
            data: [55, 58, 60, 62, 65, 68, 70, 72, 75, 78, 80, 82, 85, 87, 85, 82, 80, 78, 75, 72, 70, 68, 65, 62],
            borderColor: 'rgba(16, 185, 129, 1)',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            title: {
              display: true,
              text: 'Memory Usage (%)',
              color: 'rgba(255, 255, 255, 0.7)'
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          },
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)',
              maxRotation: 45,
              minRotation: 45
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          }
        }
      }
    });
    
    // API Requests Chart
    const apiCtx = document.getElementById('apiChart').getContext('2d');
    const apiChart = new Chart(apiCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [
          {
            label: 'API Requests (per second)',
            data: [120, 150, 180, 210, 240, 270, 300, 330, 360, 390, 420, 450, 420, 390, 360, 330, 300, 270, 240, 210, 180, 150, 120, 90],
            borderColor: 'rgba(59, 130, 246, 1)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Requests per Second',
              color: 'rgba(255, 255, 255, 0.7)'
            },
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          },
          x: {
            grid: {
              color: 'rgba(255, 255, 255, 0.1)'
            },
            ticks: {
              color: 'rgba(255, 255, 255, 0.7)',
              maxRotation: 45,
              minRotation: 45
            }
          }
        },
        plugins: {
          legend: {
            labels: {
              color: 'rgba(255, 255, 255, 0.7)'
            }
          }
        }
      }
    });
    
    // Set up time range button click handlers
    document.querySelectorAll('.time-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        // Remove active class from all buttons
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        // Add active class to clicked button
        this.classList.add('active');
        
        // In a real application, this would fetch data for the selected time range
        // For this demo, we'll just show an alert
        alert(`Selected time range: ${this.textContent}`);
      });
    });
  });
</script>
{% endblock %}
